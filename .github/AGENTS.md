# ProgShip — Global Agent Instructions

## Project
Real-time colony ship simulation. SpacetimeDB server (Rust → WASM) + Bevy 0.15 client.

## Architecture
- `crates/progship-server/` — SpacetimeDB module (tables, reducers, generation)
- `crates/progship-client-sdk/` — **Auto-generated** SDK (DO NOT modify)
- `crates/progship-client/` — Bevy 0.15 thin client (rendering, input, camera)
- `docs/vault/` — Obsidian design notes (reference only)
- `verify_doors.py` — Mathematical door verification script
- `archive/` — Old Python/Godot code (read-only reference)

## Build Commands
```bash
# Server (SpacetimeDB WASM module)
spacetime build --project-path crates/progship-server

# Client (Bevy)
cargo build --package progship-client

# All tests
cargo test --all

# Lint
cargo clippy --all-targets -- -D warnings
cargo fmt --all -- --check
```

## MANDATORY for Every PR
1. All new functions must have unit tests
2. All public functions must have `///` doc comments
3. `cargo test --all` must pass before committing
4. `cargo clippy` — zero warnings allowed
5. `cargo fmt --all -- --check` must pass
6. If `generation.rs` was modified, note in PR that door verification is needed

## Conventions
- `#[derive(Debug, Clone, Serialize, Deserialize)]` on all components/tables
- IDs are `u32` for performance, not `String`
- Components/tables are pure data — logic lives in systems/reducers
- Coordinate system: `NORTH=0` (low Y), `SOUTH=1` (high Y), `EAST=2` (high X), `WEST=3` (low X)
- 1 grid cell = 1 meter
- `f32` for all local coordinates
- Use `Option<T>` for optional fields

## DO NOT
- Modify `crates/progship-client-sdk/` (auto-generated by `spacetime generate`)
- Add external crates to `progship-server` (WASM sandbox restriction — implement algorithms from scratch)
- Modify `archive/` directory (read-only reference)
- Commit `.env` files, secrets, or API keys
- Commit binary files (`save.bin`, `*.wasm`, `target/`)
- Commit dump files (`*_dump.txt`)

## Code Style
- Minimal comments — only where logic isn't obvious
- Prefer composition over inheritance
- Error handling: return early with descriptive messages
- Keep PRs focused: one issue, one branch, one concern
